<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>マグロと炉端成る：ダッシュボード</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ===== Base ===== */
    * { margin: 0; padding: 0; box-sizing: border-box }
    html, body { height: 100%; font-family: "Yu Gothic UI","Hiragino Kaku Gothic Pro",Meiryo,sans-serif; background: #f4f6fa; color: #333 }
    a { text-decoration: none; color: inherit }
    :root { --gap: 16px; --header-h: 56px; }
    .container { max-width: 1200px; margin: 0 auto; padding: 16px }

    /* ===== Header ===== */
    header { background: #2b3a67; color: #fff }
    header a { color: #fff; display: block; padding: 12px 24px; font-size: 20px; font-weight: 700 }

    /* ===== Top section ===== */
    .top-section { display: grid; grid-template-columns: 1fr; grid-gap: var(--gap); margin-bottom: 24px }
    @media (min-width: 1024px) {
      .top-section { grid-template-columns: repeat(5, 1fr) }
      .top-section .header-card { grid-column: span 3 }
      .top-section #kpi-sales { grid-column: span 1 }
      .top-section #kpi-unitprice { grid-column: span 1 }
    }
    .header-card { background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,.08); padding: 12px 16px; display: flex; align-items: center; justify-content: space-between }
    .header-controls { display: grid; grid-template-columns: 1fr; gap: 10px }
    .header-card select,.header-card input[type="month"] { padding: 10px 12px; border: 1px solid #d0d5dd; border-radius: 8px; background: #fafafa; min-height: 40px }
    @media (min-width:768px){ .header-controls { display:flex; gap:12px; align-items:center; flex-wrap:wrap } }

    /* ===== KPI cards ===== */
    .kpi-card { background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.08); padding:16px; display:flex; flex-direction:column; justify-content:space-between; position:relative; cursor:pointer; min-height:110px }
    .kpi-card h3 { font-size: clamp(12px, 2.2vw, 14px); color:#666; margin-bottom:8px }
    .kpi-card .value { font-size: clamp(22px, 5.5vw, 28px); font-weight:700; color:#2b3a67; line-height:1.2 }
    .kpi-card .trend { display:flex; align-items:center; margin-top:8px; font-size:12px }
    .kpi-card .trend.up{ color:#31b057 } .kpi-card .trend.down{ color:#e12d39 }
    .kpi-card .trend .icon{ margin-right:4px; font-size:14px }
    .edit-btn{ position:absolute; top:8px; right:8px; border:none; background:transparent; cursor:pointer; font-size:18px; color:#98a2b3; padding:6px; border-radius:8px }
    .edit-btn:hover{ background:#f2f4f7; color:#2b3a67 }
    .mini-score{ position:absolute; top:8px; right:44px; background:#eef3ff; color:#2b3a67; padding:3px 9px; border-radius:999px; font-size:12px; font-weight:700 }
    .target-badge{ position:absolute; right:8px; bottom:8px; background:#f9fafb; border:1px solid #e5e7eb; color:#667085; padding:3px 10px; border-radius:999px; font-size:11px }

    /* ===== KPI grid responsiveness ===== */
    .kpi-row { display:grid; grid-gap:var(--gap) }
    @media (max-width: 767.98px) {
      .container { display:grid; grid-template-columns: repeat(2,1fr); grid-gap:var(--gap) }
      .top-section, .kpi-row.row-2, .kpi-row.row-3 { display: contents; }
      .header-card { grid-column: 1 / -1; }
      .kpi-card { min-height:110px }
      .panel,.chart-toolbar,.chart-section{ grid-column:1 / -1; }
    }
    @media (min-width:768px) and (max-width:1023.98px){ .kpi-row { grid-template-columns: repeat(2,1fr) } }
    @media (min-width:1024px){ .kpi-row { grid-template-columns: repeat(5,1fr) } }

    /* ===== Chart toolbar ===== */
    .chart-toolbar{ background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.08); padding:12px 16px; margin-bottom:10px; display:flex; gap:12px; align-items:center; flex-wrap:wrap; position:sticky; top: calc(var(--header-h)); z-index:50 }
    .chart-toolbar .group{ display:flex; gap:8px; align-items:center }
    .chart-toolbar label{ font-size:13px; color:#555 }
    .chart-toolbar select{ padding:10px 12px; border:1px solid #d0d5dd; border-radius:8px; background:#fafafa; min-height:40px }

    /* ===== Charts ===== */
    .chart-section{ display:grid; grid-template-columns:1fr; grid-gap:24px; margin-bottom:24px }
    .chart-card{ background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.08); position:relative }
    .chart-card canvas{ position:absolute; inset:16px }
    @media (max-width: 767.98px){ .chart-card{ height:280px } }
    @media (min-width: 768px){ .chart-card{ height:0; padding-bottom:56.25% } }

    /* ===== Ranking ===== */
    .panel{ background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.08); padding:16px; margin-bottom:24px }
    .panel h4{ margin-bottom:10px }
    .rank-wrap{ overflow-x:auto; -webkit-overflow-scrolling:touch }
    table.rank{ width:100%; border-collapse:collapse; min-width:520px }
    table.rank th, table.rank td{ padding:10px; border-bottom:1px solid #eee; text-align:left; font-size:14px; white-space:nowrap }
    table.rank th{ color:#666 }
    .rank-badge{ display:inline-block; min-width:28px; text-align:center; border-radius:999px; padding:2px 8px; background:#f0f3ff }
    .gold{ background:#fff7d6 } .silver{ background:#f2f4f7 } .bronze{ background:#ffe9d9 }

    /* ===== Modal (two-line title, scrollable, safe spacing) ===== */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:flex; align-items:center; justify-content:center; z-index:1000 }
    .modal[hidden]{ display:none }
    .modal .content{ background:#fff; border-radius:12px; box-shadow:0 10px 24px rgba(0,0,0,.18); padding:16px; min-width:320px; max-width:92vw; max-height:92vh; overflow-y:auto; -webkit-overflow-scrolling:touch; position:relative }
    .modal-head{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; position:sticky; top:0; background:#fff; margin:-16px -16px 12px -16px; padding:12px 16px; border-bottom:1px solid #eee; border-top-left-radius:12px; border-top-right-radius:12px }
    .title-wrap{ display:flex; flex-direction:column; gap:2px; min-width:0; max-width:calc(100% - 48px) }
    .title-line.store{ font-weight:700; font-size:16px; color:#2b3a67; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .title-line.sub{ font-size:13px; color:#667085; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .close-btn{ width:36px; height:36px; border:none; border-radius:10px; background:#f2f4f7; color:#333; font-size:20px; line-height:1; cursor:pointer; flex:0 0 auto }
    .close-btn:hover{ background:#e5e7eb }
    .form-row{ margin-top:10px }
    .form-row label{ display:block; font-size:12px; color:#555; margin-bottom:4px }
    .form-row input,.form-row textarea{ width:100%; padding:10px; border:1px solid #d0d5dd; border-radius:10px; background:#fafafa }
    .form-row input:focus,.form-row textarea:focus{ outline:none; border-color:#2b3a67; background:#fff }
    .actions{ display:flex; justify-content:flex-end; gap:8px; margin-top:12px; position:sticky; bottom:0; background:#fff; padding-top:8px }
    .btn{ padding:10px 14px; border:none; border-radius:10px; cursor:pointer }
    .btn.cancel{ background:#f2f4f7 } .btn.save{ background:#2b3a67; color:#fff }
    .hint{ font-size:11px; color:#667085; margin-top:6px }

    @media (max-width: 767.98px){
      .container{ padding:12px }
      .kpi-card{ padding:14px; min-height:104px }
      .edit-btn{ top:6px; right:6px }
      .mini-score{ top:6px; right:40px }
      .target-badge{ right:6px; bottom:6px; font-size:10px }
      .modal .content{ width:100vw; height:100dvh; max-width:none; border-radius:0; padding:16px }
      .modal-head{ margin:-16px -16px 12px -16px; padding:12px 16px; border-radius:0 }
    }
  </style>
</head>
<body>
  <header><a href="index.html">店舗診断表</a></header>

  <div class="container">
    <!-- 上段：ヘッダー + KPI -->
    <div class="top-section">
      <div class="header-card">
        <div class="header-controls">
          <div>
            <label for="store-select">店舗（KPI）：</label>
            <select id="store-select"><option>マグロと炉端成る</option></select>
          </div>
          <div>
            <label for="target-date">日付：</label>
            <input type="month" id="target-date" value="">
          </div>
        </div>
      </div>

      <div class="kpi-card" id="kpi-sales">
        <h3>売上</h3>
        <div class="value">-- 円</div>
        <div class="trend up"><span class="icon">▲</span><span class="percent">--%</span></div>
      </div>
      <div class="kpi-card" id="kpi-unitprice">
        <h3>単価</h3>
        <div class="value">-- 円</div>
        <div class="trend up"><span class="icon">▲</span><span class="percent">--%</span></div>
      </div>
    </div>

    <!-- 2段目 -->
    <div class="kpi-row row-2">
      <div class="kpi-card" id="kpi-labour-sales">
        <h3>人時売上高</h3>
        <div class="value">-- 円</div>
        <div class="trend up"><span class="icon">▲</span><span class="percent">--%</span></div>
      </div>
      <div class="kpi-card" id="kpi-F">
        <h3>F</h3>
        <div class="value">--%</div>
        <div class="trend up"><span class="icon">▲</span><span class="percent">--%</span></div>
      </div>
      <div class="kpi-card" id="kpi-D">
        <h3>D</h3>
        <div class="value">--%</div>
        <div class="trend down"><span class="icon">▼</span><span class="percent">--%</span></div>
      </div>
      <div class="kpi-card" id="kpi-labour-cost">
        <h3>人件費</h3>
        <div class="value">--%</div>
        <div class="trend up"><span class="icon">▲</span><span class="percent">--%</span></div>
      </div>
      <div class="kpi-card" id="kpi-inspection-sheet">
        <h3>臨店シート</h3>
        <div class="value">--</div>
        <div class="trend up"><span class="icon">▲</span><span class="percent">--%</span></div>
      </div>
    </div>

    <!-- 3段目 -->
    <div class="kpi-row row-3">
      <div class="kpi-card" id="kpi-mtg-rate">
        <h3>店舗MTG参加率</h3>
        <div class="value">--%</div>
        <div class="trend up"><span class="icon">▲</span><span class="percent">--%</span></div>
      </div>
      <div class="kpi-card" id="kpi-cs-score">
        <h3>CSアンケート</h3>
        <div class="value">-- 点</div>
        <div class="trend up"><span class="icon">▲</span><span class="percent">--%</span></div>
      </div>
      <div class="kpi-card" id="kpi-interview-progress">
        <h3>面談進捗</h3>
        <div class="value">--%</div>
        <div class="trend down"><span class="icon">▼</span><span class="percent">--%</span></div>
      </div>
      <div class="kpi-card" id="kpi-referral-hires">
        <h3>PAリファラル採用</h3>
        <div class="value">-- 名</div>
        <div class="trend up"><span class="icon">▲</span><span class="percent">--%</span></div>
      </div>
      <div class="kpi-card" id="kpi-score">
        <h3>点数（総合）</h3>
        <div class="value">-- / 110点</div>
        <div class="trend up"><span class="icon">▲</span><span class="percent">--%</span></div>
      </div>
    </div>

    <!-- ランキング -->
    <div class="panel" id="score-ranking">
      <h4>6店舗 点数ランキング（当月 / 110点満点）</h4>
      <div class="rank-wrap">
        <table class="rank" id="score-ranking-table">
          <thead>
            <tr><th>#</th><th>店舗名</th><th>点数</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- グラフツールバー -->
    <div class="chart-toolbar">
      <div class="group">
        <label for="chart-store-select">店舗（グラフ）：</label>
        <select id="chart-store-select"></select>
      </div>
      <div class="group">
        <label for="fiscal-year">期：</label>
        <select id="fiscal-year"></select>
      </div>
      <div class="group">
        <label style="display:flex;gap:6px;align-items:center;">
          <input type="checkbox" id="toggle-yoy" checked> 昨対比(%) 表示
        </label>
      </div>
    </div>

    <!-- グラフ -->
    <div class="chart-section">
      <div class="chart-card"><canvas id="salesChart"></canvas></div>
      <div class="chart-card"><canvas id="unitPriceChart"></canvas></div>
      <div class="chart-card"><canvas id="labourSalesChart"></canvas></div>
    </div>
  </div>

  <!-- 数値編集モーダル（2行タイトル） -->
  <div id="edit-modal" class="modal" hidden>
    <div class="content">
      <div class="modal-head">
        <div class="title-wrap">
          <div class="title-line store" id="edit-title-store"></div>
          <div class="title-line sub" id="edit-title-sub"></div>
        </div>
        <button class="close-btn" id="edit-close" aria-label="閉じる">×</button>
      </div>
      <input id="edit-store" type="hidden">
      <input id="edit-month" type="hidden">
      <input id="edit-item" type="hidden">
      <div class="form-row"><label>目標数値</label><input id="edit-target" type="number" step="any" placeholder="例）100000"></div>
      <div class="form-row"><label>実績</label><input id="edit-actual" type="number" step="any" placeholder="例）95000"></div>
      <div class="hint">空欄保存＝未入力として扱います。</div>
      <div class="actions">
        <button class="btn cancel" id="btn-cancel">キャンセル</button>
        <button class="btn save" id="btn-save">保存</button>
      </div>
    </div>
  </div>

  <!-- 仮説・ネクスト＆タスク送信モーダル（2行タイトル） -->
  <div id="detail-modal" class="modal" hidden>
    <div class="content">
      <div class="modal-head">
        <div class="title-wrap">
          <div class="title-line store" id="detail-title-store"></div>
          <div class="title-line sub" id="detail-title-sub"></div>
        </div>
        <button class="close-btn" id="detail-close" aria-label="閉じる">×</button>
      </div>
      <input type="hidden" id="detail-id">
      <input type="hidden" id="detail-store">
      <input type="hidden" id="detail-month">
      <input type="hidden" id="detail-item">
      <div class="form-row"><label>仮説</label><textarea id="detail-hypo" rows="3" placeholder="仮説を入力"></textarea></div>
      <div class="form-row"><label>ネクストアクション</label><textarea id="detail-next" rows="3" placeholder="次にやることを入力"></textarea></div>
      <div class="actions"><button class="btn save" id="btn-detail-save">仮説・ネクストを保存</button></div>
      <hr style="margin:12px 0;">
      <input type="hidden" id="task-item">
      <div class="form-row"><label>タスク</label><input id="task-detail" type="text" placeholder="例：棚割り見直し"></div>
      <div class="form-row"><label>期限</label><input id="task-due" type="date"></div>
      <div class="form-row"><label>責任者</label><input id="task-owner" type="text" placeholder="例：佐藤"></div>
      <div class="actions"><button class="btn save" id="btn-detail-send">タスク送信</button></div>
    </div>
  </div>

  <!-- SPA版スクリプト -->
  <script type="module" src="script.js"></script>
</body>
</html>
